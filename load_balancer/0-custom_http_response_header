#!/usr/bin/env bash
# Script to install nginx and add a custom HTTP header with the hostname

# Install nginx if not already installed
sudo apt-get update -y
sudo apt-get install -y nginx

# Ensure nginx is running
sudo systemctl start nginx
sudo systemctl enable nginx

# Add custom header to Nginx default server block
CONFIG="/etc/nginx/sites-available/default"
HEADER="add_header X-Served-By \$hostname;"

# Insert header line only if it's not already present
if ! grep -q "X-Served-By" "$CONFIG"; then
  sudo sed -i "/^\s*location \/ {/a \        $HEADER" "$CONFIG"
fi

# Test configuration and reload
sudo nginx -t && sudo systemctl reload nginx
